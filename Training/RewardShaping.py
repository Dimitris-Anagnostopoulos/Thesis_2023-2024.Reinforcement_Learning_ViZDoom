from Classes.ViZDoom_Gym import ViZDoom_Gym
import vizdoom as vzd


def deadly_corridor(self: ViZDoom_Gym, game_variables: list) -> float:
    """
    Custom reward function partially generated by ChatGPT-4o.

    :return: Extra reward according to the coefficients.
    """
    # Unpack the game variables.
    health, killcount, hits_taken, armor, pos_x = game_variables

    # Initializations.
    REWARD = 0

    MOVED_CLOSER_TO_VEST = pos_x > self.X_position
    STAYED_IN_PLACE = pos_x == self.X_position
    TOOK_DAMAGE = hits_taken > self.hits_taken
    GOT_KILL = killcount > self.killcount
    GOT_ARMOR = armor > 0
    IS_DEAD = health <= 0

    # Get (+) reward when the agent moves closer to the vest.
    if MOVED_CLOSER_TO_VEST:
        REWARD += 50

    # Get (+) reward when the agent gets a kill.
    if GOT_KILL:
        REWARD += 50

    # Get (+) reward if the agent took no extra damage this step.
    if not TOOK_DAMAGE:
        REWARD += 5

    # Get (+) reward if the agent got the armor.
    if GOT_ARMOR:
        REWARD += 1000

    # Get (-) if the agent dies.
    if IS_DEAD:
        REWARD -= 50

    # Get (-) reward only when the agent gets hit.
    if TOOK_DAMAGE:
        REWARD -= 15

    # Get (-) reward only when the agent moves away from the vest.
    if not MOVED_CLOSER_TO_VEST:
        REWARD -= 50

    # Get (-) reward when the agent stays in place.
    if STAYED_IN_PLACE:
        REWARD -= 5

    # Get (-) reward per timestep.
    REWARD += 1

    # Update the values for the next step.
    self.killcount = killcount
    self.hits_taken = hits_taken
    self.X_position = pos_x

    return REWARD


def defend_the_center(self: ViZDoom_Gym, game_variables: list) -> float:
    # Unpack game variables.
    ammo, health, killcount = game_variables

    # Initial reward.
    REWARD = 0

    SPENT_AMMO = ammo < self.previous_ammo
    GOT_KILL = killcount > self.killcount

    # Reward for killing a monster.
    if GOT_KILL:
        REWARD += 2

    # Penalty for wasting ammunition without getting any kills.
    if SPENT_AMMO and not GOT_KILL:
        REWARD -= 0.5

    REWARD += 0.05

    self.previous_shot_time = self.game.get_episode_time()
    self.killcount = killcount
    self.previous_ammo = ammo

    return REWARD


def defend_the_line(self: ViZDoom_Gym, game_variables: list):
    # Unpack the game variables.
    ammo, health, killcount, camera_angle = game_variables

    # Initialize the Reward.
    REWARD = 0

    # Initialize useful variables.
    LOOKS_AHEAD = (330 <= camera_angle <= 360) or (0 <= camera_angle <= 30)
    SPENT_AMMO = self.game.get_button(vzd.ATTACK) == 1
    GOT_KILL = killcount > self.killcount

    # Reward the agent for getting a kill.
    if GOT_KILL:
        REWARD += 3

    # Reward the agent for looking ahead at the enemies.
    if LOOKS_AHEAD:
        REWARD += 0.1

    # Punish the agent for spending ammo without getting kills.
    if SPENT_AMMO and not GOT_KILL:
        REWARD -= 1

    # Punish the agent for looking too far to the left or the right.
    if not LOOKS_AHEAD:
        REWARD -= 0.2

    # Update game variables.
    self.killcount = killcount

    return REWARD
